(()=>{var __webpack_modules__={738:()=>{eval("(function (PLUGIN_ID) {\n  'use strict';\n  // mermaid.jsをロードする\n  const script = document.createElement('script');\n  script.src = 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js';\n  document.head.appendChild(script);\n\n  script.onload = () => {\n    mermaid.initialize({ startOnLoad: false });\n  };\n\n  const config = kintone.plugin.app.getConfig(PLUGIN_ID);\n  kintone.events.on('app.record.index.show', async (event) => {\n    const viewId = config.viewId;\n    if (String(event.viewId) !== viewId) {\n      return;\n    }\n\n    const ganttDiagram = generateGanttDiagram(event);\n    const type = mermaid.detectType(ganttDiagram);\n    console.log(type);\n    const content = document.querySelector('#gantt-diagram');\n    const diagram = document.createElement('div');\n    diagram.id = 'diagram';\n    diagram.className = 'mermaid';\n    const { svg } = await mermaid.render('diagram', ganttDiagram);\n    diagram.innerHTML = svg;\n    content.appendChild(diagram);\n  });\n\n  const SECTION_FIELD_CODE = '開発対象のアプリ';\n  const TASK_FIELD_CODE = 'タスク名';\n  const TASK_STATUS_FIELD_CODE = 'gantt_status';\n  const TASK_ID_FIELD_CODE = 'タスク名';\n  const START_DATE_FIELD_CODE = '開始日';\n  const END_DATE_FIELD_CODE = '終了日';\n\n  function generateGanttDiagram(event) {\n    const records = event.records;\n    const sectionTasks = {};\n\n    // セクション別にタスクを集約\n    records.forEach(record => {\n      const section = record[SECTION_FIELD_CODE].value;\n      const task = record[TASK_FIELD_CODE].value;\n      const status = record[TASK_STATUS_FIELD_CODE].value;\n      const taskId = record[TASK_ID_FIELD_CODE].value;\n      const startDate = record[START_DATE_FIELD_CODE].value;\n      const endDate = record[END_DATE_FIELD_CODE].value;\n\n      if (!sectionTasks[section]) {\n        sectionTasks[section] = [];\n      }\n\n      sectionTasks[section].push({\n        task,\n        status,\n        taskId,\n        startDate,\n        endDate\n      });\n    });\n\n    // mermaid記法に変換\n    let mermaidDiagram = 'gantt\\n  dateFormat YYYY-MM-DD\\n  title Gantt Chart\\n';\n\n    Object.keys(sectionTasks).forEach(section => {\n      mermaidDiagram += `section ${section}\\n`;\n\n      sectionTasks[section].forEach(task => {\n        const { task: taskName, status, taskId, startDate, endDate } = task;\n        const taskStatus = status ? `${status},` : '';\n        mermaidDiagram += `${taskName} :${taskStatus} ${taskId}, ${startDate}, ${endDate}\\n`;\n      });\n    });\n\n    return mermaidDiagram;\n  }\n\n})(kintone.$PLUGIN_ID);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzM4LmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlCQUF5QixvQkFBb0I7QUFDN0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBLG1DQUFtQyxRQUFROztBQUUzQztBQUNBLGdCQUFnQixxREFBcUQ7QUFDckUsdUNBQXVDLE9BQU87QUFDOUMsNkJBQTZCLFVBQVUsR0FBRyxZQUFZLEVBQUUsT0FBTyxJQUFJLFVBQVUsSUFBSSxRQUFRO0FBQ3pGLE9BQU87QUFDUCxLQUFLOztBQUVMO0FBQ0E7O0FBRUEsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2dhbnR0LW9uLWtpbnRvbmUvLi9zcmMvanMvZGVza3RvcC5qcz9jNjFjIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoUExVR0lOX0lEKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLy8gbWVybWFpZC5qc+OCkuODreODvOODieOBmeOCi1xuICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgc2NyaXB0LnNyYyA9ICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21lcm1haWQvZGlzdC9tZXJtYWlkLm1pbi5qcyc7XG4gIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblxuICBzY3JpcHQub25sb2FkID0gKCkgPT4ge1xuICAgIG1lcm1haWQuaW5pdGlhbGl6ZSh7IHN0YXJ0T25Mb2FkOiBmYWxzZSB9KTtcbiAgfTtcblxuICBjb25zdCBjb25maWcgPSBraW50b25lLnBsdWdpbi5hcHAuZ2V0Q29uZmlnKFBMVUdJTl9JRCk7XG4gIGtpbnRvbmUuZXZlbnRzLm9uKCdhcHAucmVjb3JkLmluZGV4LnNob3cnLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICBjb25zdCB2aWV3SWQgPSBjb25maWcudmlld0lkO1xuICAgIGlmIChTdHJpbmcoZXZlbnQudmlld0lkKSAhPT0gdmlld0lkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZ2FudHREaWFncmFtID0gZ2VuZXJhdGVHYW50dERpYWdyYW0oZXZlbnQpO1xuICAgIGNvbnN0IHR5cGUgPSBtZXJtYWlkLmRldGVjdFR5cGUoZ2FudHREaWFncmFtKTtcbiAgICBjb25zb2xlLmxvZyh0eXBlKTtcbiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbnR0LWRpYWdyYW0nKTtcbiAgICBjb25zdCBkaWFncmFtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGlhZ3JhbS5pZCA9ICdkaWFncmFtJztcbiAgICBkaWFncmFtLmNsYXNzTmFtZSA9ICdtZXJtYWlkJztcbiAgICBjb25zdCB7IHN2ZyB9ID0gYXdhaXQgbWVybWFpZC5yZW5kZXIoJ2RpYWdyYW0nLCBnYW50dERpYWdyYW0pO1xuICAgIGRpYWdyYW0uaW5uZXJIVE1MID0gc3ZnO1xuICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZGlhZ3JhbSk7XG4gIH0pO1xuXG4gIGNvbnN0IFNFQ1RJT05fRklFTERfQ09ERSA9ICfplovnmbrlr77osaHjga7jgqLjg5fjg6onO1xuICBjb25zdCBUQVNLX0ZJRUxEX0NPREUgPSAn44K/44K544Kv5ZCNJztcbiAgY29uc3QgVEFTS19TVEFUVVNfRklFTERfQ09ERSA9ICdnYW50dF9zdGF0dXMnO1xuICBjb25zdCBUQVNLX0lEX0ZJRUxEX0NPREUgPSAn44K/44K544Kv5ZCNJztcbiAgY29uc3QgU1RBUlRfREFURV9GSUVMRF9DT0RFID0gJ+mWi+Wni+aXpSc7XG4gIGNvbnN0IEVORF9EQVRFX0ZJRUxEX0NPREUgPSAn57WC5LqG5pelJztcblxuICBmdW5jdGlvbiBnZW5lcmF0ZUdhbnR0RGlhZ3JhbShldmVudCkge1xuICAgIGNvbnN0IHJlY29yZHMgPSBldmVudC5yZWNvcmRzO1xuICAgIGNvbnN0IHNlY3Rpb25UYXNrcyA9IHt9O1xuXG4gICAgLy8g44K744Kv44K344On44Oz5Yil44Gr44K/44K544Kv44KS6ZuG57SEXG4gICAgcmVjb3Jkcy5mb3JFYWNoKHJlY29yZCA9PiB7XG4gICAgICBjb25zdCBzZWN0aW9uID0gcmVjb3JkW1NFQ1RJT05fRklFTERfQ09ERV0udmFsdWU7XG4gICAgICBjb25zdCB0YXNrID0gcmVjb3JkW1RBU0tfRklFTERfQ09ERV0udmFsdWU7XG4gICAgICBjb25zdCBzdGF0dXMgPSByZWNvcmRbVEFTS19TVEFUVVNfRklFTERfQ09ERV0udmFsdWU7XG4gICAgICBjb25zdCB0YXNrSWQgPSByZWNvcmRbVEFTS19JRF9GSUVMRF9DT0RFXS52YWx1ZTtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHJlY29yZFtTVEFSVF9EQVRFX0ZJRUxEX0NPREVdLnZhbHVlO1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IHJlY29yZFtFTkRfREFURV9GSUVMRF9DT0RFXS52YWx1ZTtcblxuICAgICAgaWYgKCFzZWN0aW9uVGFza3Nbc2VjdGlvbl0pIHtcbiAgICAgICAgc2VjdGlvblRhc2tzW3NlY3Rpb25dID0gW107XG4gICAgICB9XG5cbiAgICAgIHNlY3Rpb25UYXNrc1tzZWN0aW9uXS5wdXNoKHtcbiAgICAgICAgdGFzayxcbiAgICAgICAgc3RhdHVzLFxuICAgICAgICB0YXNrSWQsXG4gICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgZW5kRGF0ZVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBtZXJtYWlk6KiY5rOV44Gr5aSJ5o+bXG4gICAgbGV0IG1lcm1haWREaWFncmFtID0gJ2dhbnR0XFxuICBkYXRlRm9ybWF0IFlZWVktTU0tRERcXG4gIHRpdGxlIEdhbnR0IENoYXJ0XFxuJztcblxuICAgIE9iamVjdC5rZXlzKHNlY3Rpb25UYXNrcykuZm9yRWFjaChzZWN0aW9uID0+IHtcbiAgICAgIG1lcm1haWREaWFncmFtICs9IGBzZWN0aW9uICR7c2VjdGlvbn1cXG5gO1xuXG4gICAgICBzZWN0aW9uVGFza3Nbc2VjdGlvbl0uZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgY29uc3QgeyB0YXNrOiB0YXNrTmFtZSwgc3RhdHVzLCB0YXNrSWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9ID0gdGFzaztcbiAgICAgICAgY29uc3QgdGFza1N0YXR1cyA9IHN0YXR1cyA/IGAke3N0YXR1c30sYCA6ICcnO1xuICAgICAgICBtZXJtYWlkRGlhZ3JhbSArPSBgJHt0YXNrTmFtZX0gOiR7dGFza1N0YXR1c30gJHt0YXNrSWR9LCAke3N0YXJ0RGF0ZX0sICR7ZW5kRGF0ZX1cXG5gO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbWVybWFpZERpYWdyYW07XG4gIH1cblxufSkoa2ludG9uZS4kUExVR0lOX0lEKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///738\n")}},__webpack_exports__={};__webpack_modules__[738]()})();