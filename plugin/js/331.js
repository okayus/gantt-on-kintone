"use strict";(self.webpackChunkgantt_on_kintone=self.webpackChunkgantt_on_kintone||[]).push([[331],{1331:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   diagram: () => (/* binding */ diagram)\n/* harmony export */ });\n/* harmony import */ var _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(1245);\n/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8918);\n/* harmony import */ var dagre_d3_es_src_dagre_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(944);\n/* harmony import */ var dagre_d3_es_src_graphlib_index_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(697);\n/* harmony import */ var _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(5950);\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(4353);\n/* harmony import */ var _braintree_sanitize_url__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(6750);\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2838);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst idCache = {};\nconst set = (key, val) => {\n  idCache[key] = val;\n};\nconst get = (k) => idCache[k];\nconst keys = () => Object.keys(idCache);\nconst size = () => keys().length;\nconst idCache$1 = {\n  get,\n  set,\n  keys,\n  size\n};\nconst drawStartState = (g) => g.append("circle").attr("class", "start-state").attr("r", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit).attr("cx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit).attr("cy", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit);\nconst drawDivider = (g) => g.append("line").style("stroke", "grey").style("stroke-dasharray", "3").attr("x1", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight).attr("class", "divider").attr("x2", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight * 2).attr("y1", 0).attr("y2", 0);\nconst drawSimpleState = (g, stateDef) => {\n  const state = g.append("text").attr("x", 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("font-size", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.fontSize).attr("class", "state-title").text(stateDef.id);\n  const classBox = state.node().getBBox();\n  g.insert("rect", ":first-child").attr("x", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("width", classBox.width + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("height", classBox.height + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("rx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.radius);\n  return state;\n};\nconst drawDescrState = (g, stateDef) => {\n  const addTspan = function(textEl, txt, isFirst2) {\n    const tSpan = textEl.append("tspan").attr("x", 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).text(txt);\n    if (!isFirst2) {\n      tSpan.attr("dy", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight);\n    }\n  };\n  const title = g.append("text").attr("x", 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight + 1.3 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("font-size", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.fontSize).attr("class", "state-title").text(stateDef.descriptions[0]);\n  const titleBox = title.node().getBBox();\n  const titleHeight = titleBox.height;\n  const description = g.append("text").attr("x", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr(\n    "y",\n    titleHeight + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding * 0.4 + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.dividerMargin + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight\n  ).attr("class", "state-description");\n  let isFirst = true;\n  let isSecond = true;\n  stateDef.descriptions.forEach(function(descr) {\n    if (!isFirst) {\n      addTspan(description, descr, isSecond);\n      isSecond = false;\n    }\n    isFirst = false;\n  });\n  const descrLine = g.append("line").attr("x1", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y1", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + titleHeight + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.dividerMargin / 2).attr("y2", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + titleHeight + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.dividerMargin / 2).attr("class", "descr-divider");\n  const descrBox = description.node().getBBox();\n  const width = Math.max(descrBox.width, titleBox.width);\n  descrLine.attr("x2", width + 3 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding);\n  g.insert("rect", ":first-child").attr("x", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("width", width + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("height", descrBox.height + titleHeight + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("rx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.radius);\n  return g;\n};\nconst addTitleAndBox = (g, stateDef, altBkg) => {\n  const pad = (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding;\n  const dblPad = 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding;\n  const orgBox = g.node().getBBox();\n  const orgWidth = orgBox.width;\n  const orgX = orgBox.x;\n  const title = g.append("text").attr("x", 0).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.titleShift).attr("font-size", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.fontSize).attr("class", "state-title").text(stateDef.id);\n  const titleBox = title.node().getBBox();\n  const titleWidth = titleBox.width + dblPad;\n  let width = Math.max(titleWidth, orgWidth);\n  if (width === orgWidth) {\n    width = width + dblPad;\n  }\n  let startX;\n  const graphBox = g.node().getBBox();\n  if (stateDef.doc)\n    ;\n  startX = orgX - pad;\n  if (titleWidth > orgWidth) {\n    startX = (orgWidth - width) / 2 + pad;\n  }\n  if (Math.abs(orgX - graphBox.x) < pad && titleWidth > orgWidth) {\n    startX = orgX - (titleWidth - orgWidth) / 2;\n  }\n  const lineY = 1 - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight;\n  g.insert("rect", ":first-child").attr("x", startX).attr("y", lineY).attr("class", altBkg ? "alt-composit" : "composit").attr("width", width).attr(\n    "height",\n    graphBox.height + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.titleShift + 1\n  ).attr("rx", "0");\n  title.attr("x", startX + pad);\n  if (titleWidth <= orgWidth) {\n    title.attr("x", orgX + (width - dblPad) / 2 - titleWidth / 2 + pad);\n  }\n  g.insert("rect", ":first-child").attr("x", startX).attr(\n    "y",\n    (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.titleShift - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding\n  ).attr("width", width).attr("height", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight * 3).attr("rx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.radius);\n  g.insert("rect", ":first-child").attr("x", startX).attr(\n    "y",\n    (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.titleShift - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding\n  ).attr("width", width).attr("height", graphBox.height + 3 + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.textHeight).attr("rx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.radius);\n  return g;\n};\nconst drawEndState = (g) => {\n  g.append("circle").attr("class", "end-state-outer").attr("r", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.miniPadding).attr(\n    "cx",\n    (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.miniPadding\n  ).attr(\n    "cy",\n    (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.miniPadding\n  );\n  return g.append("circle").attr("class", "end-state-inner").attr("r", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit).attr("cx", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit + 2).attr("cy", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.sizeUnit + 2);\n};\nconst drawForkJoinState = (g, stateDef) => {\n  let width = (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.forkWidth;\n  let height = (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.forkHeight;\n  if (stateDef.parentId) {\n    let tmp = width;\n    width = height;\n    height = tmp;\n  }\n  return g.append("rect").style("stroke", "black").style("fill", "black").attr("width", width).attr("height", height).attr("x", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding);\n};\nconst _drawLongText = (_text, x, y, g) => {\n  let textHeight = 0;\n  const textElem = g.append("text");\n  textElem.style("text-anchor", "start");\n  textElem.attr("class", "noteText");\n  let text = _text.replace(/\\r\\n/g, "<br/>");\n  text = text.replace(/\\n/g, "<br/>");\n  const lines = text.split(_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.e.lineBreakRegex);\n  let tHeight = 1.25 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.noteMargin;\n  for (const line2 of lines) {\n    const txt = line2.trim();\n    if (txt.length > 0) {\n      const span = textElem.append("tspan");\n      span.text(txt);\n      if (tHeight === 0) {\n        const textBounds = span.node().getBBox();\n        tHeight += textBounds.height;\n      }\n      textHeight += tHeight;\n      span.attr("x", x + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.noteMargin);\n      span.attr("y", y + textHeight + 1.25 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.noteMargin);\n    }\n  }\n  return { textWidth: textElem.node().getBBox().width, textHeight };\n};\nconst drawNote = (text, g) => {\n  g.attr("class", "state-note");\n  const note = g.append("rect").attr("x", 0).attr("y", (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding);\n  const rectElem = g.append("g");\n  const { textWidth, textHeight } = _drawLongText(text, 0, 0, rectElem);\n  note.attr("height", textHeight + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.noteMargin);\n  note.attr("width", textWidth + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.noteMargin * 2);\n  return note;\n};\nconst drawState = function(elem, stateDef) {\n  const id = stateDef.id;\n  const stateInfo = {\n    id,\n    label: stateDef.id,\n    width: 0,\n    height: 0\n  };\n  const g = elem.append("g").attr("id", id).attr("class", "stateGroup");\n  if (stateDef.type === "start") {\n    drawStartState(g);\n  }\n  if (stateDef.type === "end") {\n    drawEndState(g);\n  }\n  if (stateDef.type === "fork" || stateDef.type === "join") {\n    drawForkJoinState(g, stateDef);\n  }\n  if (stateDef.type === "note") {\n    drawNote(stateDef.note.text, g);\n  }\n  if (stateDef.type === "divider") {\n    drawDivider(g);\n  }\n  if (stateDef.type === "default" && stateDef.descriptions.length === 0) {\n    drawSimpleState(g, stateDef);\n  }\n  if (stateDef.type === "default" && stateDef.descriptions.length > 0) {\n    drawDescrState(g, stateDef);\n  }\n  const stateBox = g.node().getBBox();\n  stateInfo.width = stateBox.width + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding;\n  stateInfo.height = stateBox.height + 2 * (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding;\n  idCache$1.set(id, stateInfo);\n  return stateInfo;\n};\nlet edgeCount = 0;\nconst drawEdge = function(elem, path, relation) {\n  const getRelationType = function(type) {\n    switch (type) {\n      case _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.relationType.AGGREGATION:\n        return "aggregation";\n      case _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.relationType.EXTENSION:\n        return "extension";\n      case _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.relationType.COMPOSITION:\n        return "composition";\n      case _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.relationType.DEPENDENCY:\n        return "dependency";\n    }\n  };\n  path.points = path.points.filter((p) => !Number.isNaN(p.y));\n  const lineData = path.points;\n  const lineFunction = (0,d3__WEBPACK_IMPORTED_MODULE_0__/* .line */ .n8j)().x(function(d) {\n    return d.x;\n  }).y(function(d) {\n    return d.y;\n  }).curve(d3__WEBPACK_IMPORTED_MODULE_0__/* .curveBasis */ .qrM);\n  const svgPath = elem.append("path").attr("d", lineFunction(lineData)).attr("id", "edge" + edgeCount).attr("class", "transition");\n  let url = "";\n  if ((0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.arrowMarkerAbsolute) {\n    url = window.location.protocol + "//" + window.location.host + window.location.pathname + window.location.search;\n    url = url.replace(/\\(/g, "\\\\(");\n    url = url.replace(/\\)/g, "\\\\)");\n  }\n  svgPath.attr(\n    "marker-end",\n    "url(" + url + "#" + getRelationType(_styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.relationType.DEPENDENCY) + "End)"\n  );\n  if (relation.title !== void 0) {\n    const label = elem.append("g").attr("class", "stateLabel");\n    const { x, y } = _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.u.calcLabelPosition(path.points);\n    const rows = _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.e.getRows(relation.title);\n    let titleHeight = 0;\n    const titleRows = [];\n    let maxWidth = 0;\n    let minX = 0;\n    for (let i = 0; i <= rows.length; i++) {\n      const title = label.append("text").attr("text-anchor", "middle").text(rows[i]).attr("x", x).attr("y", y + titleHeight);\n      const boundsTmp = title.node().getBBox();\n      maxWidth = Math.max(maxWidth, boundsTmp.width);\n      minX = Math.min(minX, boundsTmp.x);\n      _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.info(boundsTmp.x, x, y + titleHeight);\n      if (titleHeight === 0) {\n        const titleBox = title.node().getBBox();\n        titleHeight = titleBox.height;\n        _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.info("Title height", titleHeight, y);\n      }\n      titleRows.push(title);\n    }\n    let boxHeight = titleHeight * rows.length;\n    if (rows.length > 1) {\n      const heightAdj = (rows.length - 1) * titleHeight * 0.5;\n      titleRows.forEach((title, i) => title.attr("y", y + i * titleHeight - heightAdj));\n      boxHeight = titleHeight * rows.length;\n    }\n    const bounds = label.node().getBBox();\n    label.insert("rect", ":first-child").attr("class", "box").attr("x", x - maxWidth / 2 - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding / 2).attr("y", y - boxHeight / 2 - (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding / 2 - 3.5).attr("width", maxWidth + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding).attr("height", boxHeight + (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state.padding);\n    _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.info(bounds);\n  }\n  edgeCount++;\n};\nlet conf;\nconst transformationLog = {};\nconst setConf = function() {\n};\nconst insertMarkers = function(elem) {\n  elem.append("defs").append("marker").attr("id", "dependencyEnd").attr("refX", 19).attr("refY", 7).attr("markerWidth", 20).attr("markerHeight", 28).attr("orient", "auto").append("path").attr("d", "M 19,7 L9,13 L14,7 L9,1 Z");\n};\nconst draw = function(text, id, _version, diagObj) {\n  conf = (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().state;\n  const securityLevel = (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.c)().securityLevel;\n  let sandboxElement;\n  if (securityLevel === "sandbox") {\n    sandboxElement = (0,d3__WEBPACK_IMPORTED_MODULE_0__/* .select */ .Ltv)("#i" + id);\n  }\n  const root = securityLevel === "sandbox" ? (0,d3__WEBPACK_IMPORTED_MODULE_0__/* .select */ .Ltv)(sandboxElement.nodes()[0].contentDocument.body) : (0,d3__WEBPACK_IMPORTED_MODULE_0__/* .select */ .Ltv)("body");\n  const doc = securityLevel === "sandbox" ? sandboxElement.nodes()[0].contentDocument : document;\n  _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Rendering diagram " + text);\n  const diagram2 = root.select(`[id=\'${id}\']`);\n  insertMarkers(diagram2);\n  const rootDoc = diagObj.db.getRootDoc();\n  renderDoc(rootDoc, diagram2, void 0, false, root, doc, diagObj);\n  const padding = conf.padding;\n  const bounds = diagram2.node().getBBox();\n  const width = bounds.width + padding * 2;\n  const height = bounds.height + padding * 2;\n  const svgWidth = width * 1.75;\n  (0,_mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.i)(diagram2, height, svgWidth, conf.useMaxWidth);\n  diagram2.attr(\n    "viewBox",\n    `${bounds.x - conf.padding}  ${bounds.y - conf.padding} ` + width + " " + height\n  );\n};\nconst getLabelWidth = (text) => {\n  return text ? text.length * conf.fontSizeFactor : 1;\n};\nconst renderDoc = (doc, diagram2, parentId, altBkg, root, domDocument, diagObj) => {\n  const graph = new dagre_d3_es_src_graphlib_index_js__WEBPACK_IMPORTED_MODULE_2__/* .Graph */ .T({\n    compound: true,\n    multigraph: true\n  });\n  let i;\n  let edgeFreeDoc = true;\n  for (i = 0; i < doc.length; i++) {\n    if (doc[i].stmt === "relation") {\n      edgeFreeDoc = false;\n      break;\n    }\n  }\n  if (parentId) {\n    graph.setGraph({\n      rankdir: "LR",\n      multigraph: true,\n      compound: true,\n      // acyclicer: \'greedy\',\n      ranker: "tight-tree",\n      ranksep: edgeFreeDoc ? 1 : conf.edgeLengthFactor,\n      nodeSep: edgeFreeDoc ? 1 : 50,\n      isMultiGraph: true\n      // ranksep: 5,\n      // nodesep: 1\n    });\n  } else {\n    graph.setGraph({\n      rankdir: "TB",\n      multigraph: true,\n      compound: true,\n      // isCompound: true,\n      // acyclicer: \'greedy\',\n      // ranker: \'longest-path\'\n      ranksep: edgeFreeDoc ? 1 : conf.edgeLengthFactor,\n      nodeSep: edgeFreeDoc ? 1 : 50,\n      ranker: "tight-tree",\n      // ranker: \'network-simplex\'\n      isMultiGraph: true\n    });\n  }\n  graph.setDefaultEdgeLabel(function() {\n    return {};\n  });\n  diagObj.db.extract(doc);\n  const states = diagObj.db.getStates();\n  const relations = diagObj.db.getRelations();\n  const keys2 = Object.keys(states);\n  for (const key of keys2) {\n    const stateDef = states[key];\n    if (parentId) {\n      stateDef.parentId = parentId;\n    }\n    let node;\n    if (stateDef.doc) {\n      let sub = diagram2.append("g").attr("id", stateDef.id).attr("class", "stateGroup");\n      node = renderDoc(stateDef.doc, sub, stateDef.id, !altBkg, root, domDocument, diagObj);\n      {\n        sub = addTitleAndBox(sub, stateDef, altBkg);\n        let boxBounds = sub.node().getBBox();\n        node.width = boxBounds.width;\n        node.height = boxBounds.height + conf.padding / 2;\n        transformationLog[stateDef.id] = { y: conf.compositTitleSize };\n      }\n    } else {\n      node = drawState(diagram2, stateDef);\n    }\n    if (stateDef.note) {\n      const noteDef = {\n        descriptions: [],\n        id: stateDef.id + "-note",\n        note: stateDef.note,\n        type: "note"\n      };\n      const note = drawState(diagram2, noteDef);\n      if (stateDef.note.position === "left of") {\n        graph.setNode(node.id + "-note", note);\n        graph.setNode(node.id, node);\n      } else {\n        graph.setNode(node.id, node);\n        graph.setNode(node.id + "-note", note);\n      }\n      graph.setParent(node.id, node.id + "-group");\n      graph.setParent(node.id + "-note", node.id + "-group");\n    } else {\n      graph.setNode(node.id, node);\n    }\n  }\n  _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Count=", graph.nodeCount(), graph);\n  let cnt = 0;\n  relations.forEach(function(relation) {\n    cnt++;\n    _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Setting edge", relation);\n    graph.setEdge(\n      relation.id1,\n      relation.id2,\n      {\n        relation,\n        width: getLabelWidth(relation.title),\n        height: conf.labelHeight * _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.e.getRows(relation.title).length,\n        labelpos: "c"\n      },\n      "id" + cnt\n    );\n  });\n  (0,dagre_d3_es_src_dagre_index_js__WEBPACK_IMPORTED_MODULE_1__/* .layout */ .Zp)(graph);\n  _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Graph after layout", graph.nodes());\n  const svgElem = diagram2.node();\n  graph.nodes().forEach(function(v) {\n    if (v !== void 0 && graph.node(v) !== void 0) {\n      _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.warn("Node " + v + ": " + JSON.stringify(graph.node(v)));\n      root.select("#" + svgElem.id + " #" + v).attr(\n        "transform",\n        "translate(" + (graph.node(v).x - graph.node(v).width / 2) + "," + (graph.node(v).y + (transformationLog[v] ? transformationLog[v].y : 0) - graph.node(v).height / 2) + " )"\n      );\n      root.select("#" + svgElem.id + " #" + v).attr("data-x-shift", graph.node(v).x - graph.node(v).width / 2);\n      const dividers = domDocument.querySelectorAll("#" + svgElem.id + " #" + v + " .divider");\n      dividers.forEach((divider) => {\n        const parent = divider.parentElement;\n        let pWidth = 0;\n        let pShift = 0;\n        if (parent) {\n          if (parent.parentElement) {\n            pWidth = parent.parentElement.getBBox().width;\n          }\n          pShift = parseInt(parent.getAttribute("data-x-shift"), 10);\n          if (Number.isNaN(pShift)) {\n            pShift = 0;\n          }\n        }\n        divider.setAttribute("x1", 0 - pShift + 8);\n        divider.setAttribute("x2", pWidth - pShift - 8);\n      });\n    } else {\n      _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("No Node " + v + ": " + JSON.stringify(graph.node(v)));\n    }\n  });\n  let stateBox = svgElem.getBBox();\n  graph.edges().forEach(function(e) {\n    if (e !== void 0 && graph.edge(e) !== void 0) {\n      _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Edge " + e.v + " -> " + e.w + ": " + JSON.stringify(graph.edge(e)));\n      drawEdge(diagram2, graph.edge(e), graph.edge(e).relation);\n    }\n  });\n  stateBox = svgElem.getBBox();\n  const stateInfo = {\n    id: parentId ? parentId : "root",\n    label: parentId ? parentId : "root",\n    width: 0,\n    height: 0\n  };\n  stateInfo.width = stateBox.width + 2 * conf.padding;\n  stateInfo.height = stateBox.height + 2 * conf.padding;\n  _mermaid_6dc72991_js__WEBPACK_IMPORTED_MODULE_6__.l.debug("Doc rendered", stateInfo, graph);\n  return stateInfo;\n};\nconst renderer = {\n  setConf,\n  draw\n};\nconst diagram = {\n  parser: _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.p,\n  db: _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d,\n  renderer,\n  styles: _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.s,\n  init: (cnf) => {\n    if (!cnf.state) {\n      cnf.state = {};\n    }\n    cnf.state.arrowMarkerAbsolute = cnf.arrowMarkerAbsolute;\n    _styles_0784dbeb_js__WEBPACK_IMPORTED_MODULE_7__.d.clear();\n  }\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0EsbUNBQW1DLG1EQUFNO0FBQ3pDO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnRkFBTTtBQUNSLEVBQUUsbURBQUc7QUFDTDtBQUNBO0FBQ0E7QUFDQSxNQUFNLG1EQUFHO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTixNQUFNLG1EQUFHO0FBQ1Q7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsTUFBTSxtREFBRztBQUNUO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSxtREFBRztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSLElBQUk7QUFDSjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxrREFBRTtBQUNOO0FBQ0E7QUFHRSIsInNvdXJjZXMiOlsid2VicGFjazovL2dhbnR0LW9uLWtpbnRvbmUvLi9ub2RlX21vZHVsZXMvbWVybWFpZC9kaXN0L3N0YXRlRGlhZ3JhbS01ZGVlOTQwZC5qcz9hNzQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGQgYXMgZGIsIHAgYXMgcGFyc2VyLCBzIGFzIHN0eWxlcyB9IGZyb20gXCIuL3N0eWxlcy0wNzg0ZGJlYi5qc1wiO1xuaW1wb3J0IHsgbGluZSwgY3VydmVCYXNpcywgc2VsZWN0IH0gZnJvbSBcImQzXCI7XG5pbXBvcnQgeyBsYXlvdXQgfSBmcm9tIFwiZGFncmUtZDMtZXMvc3JjL2RhZ3JlL2luZGV4LmpzXCI7XG5pbXBvcnQgKiBhcyBncmFwaGxpYiBmcm9tIFwiZGFncmUtZDMtZXMvc3JjL2dyYXBobGliL2luZGV4LmpzXCI7XG5pbXBvcnQgeyBjIGFzIGdldENvbmZpZywgdSBhcyB1dGlscywgZSBhcyBjb21tb24sIGwgYXMgbG9nLCBpIGFzIGNvbmZpZ3VyZVN2Z1NpemUgfSBmcm9tIFwiLi9tZXJtYWlkLTZkYzcyOTkxLmpzXCI7XG5pbXBvcnQgXCJ0cy1kZWRlbnRcIjtcbmltcG9ydCBcImRheWpzXCI7XG5pbXBvcnQgXCJAYnJhaW50cmVlL3Nhbml0aXplLXVybFwiO1xuaW1wb3J0IFwiZG9tcHVyaWZ5XCI7XG5pbXBvcnQgXCJraHJvbWFcIjtcbmltcG9ydCBcImxvZGFzaC1lcy9tZW1vaXplLmpzXCI7XG5pbXBvcnQgXCJsb2Rhc2gtZXMvbWVyZ2UuanNcIjtcbmltcG9ydCBcInN0eWxpc1wiO1xuaW1wb3J0IFwibG9kYXNoLWVzL2lzRW1wdHkuanNcIjtcbmNvbnN0IGlkQ2FjaGUgPSB7fTtcbmNvbnN0IHNldCA9IChrZXksIHZhbCkgPT4ge1xuICBpZENhY2hlW2tleV0gPSB2YWw7XG59O1xuY29uc3QgZ2V0ID0gKGspID0+IGlkQ2FjaGVba107XG5jb25zdCBrZXlzID0gKCkgPT4gT2JqZWN0LmtleXMoaWRDYWNoZSk7XG5jb25zdCBzaXplID0gKCkgPT4ga2V5cygpLmxlbmd0aDtcbmNvbnN0IGlkQ2FjaGUkMSA9IHtcbiAgZ2V0LFxuICBzZXQsXG4gIGtleXMsXG4gIHNpemVcbn07XG5jb25zdCBkcmF3U3RhcnRTdGF0ZSA9IChnKSA9PiBnLmFwcGVuZChcImNpcmNsZVwiKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGFydC1zdGF0ZVwiKS5hdHRyKFwiclwiLCBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCkuYXR0cihcImN4XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCkuYXR0cihcImN5XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCk7XG5jb25zdCBkcmF3RGl2aWRlciA9IChnKSA9PiBnLmFwcGVuZChcImxpbmVcIikuc3R5bGUoXCJzdHJva2VcIiwgXCJncmV5XCIpLnN0eWxlKFwic3Ryb2tlLWRhc2hhcnJheVwiLCBcIjNcIikuYXR0cihcIngxXCIsIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQpLmF0dHIoXCJjbGFzc1wiLCBcImRpdmlkZXJcIikuYXR0cihcIngyXCIsIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgKiAyKS5hdHRyKFwieTFcIiwgMCkuYXR0cihcInkyXCIsIDApO1xuY29uc3QgZHJhd1NpbXBsZVN0YXRlID0gKGcsIHN0YXRlRGVmKSA9PiB7XG4gIGNvbnN0IHN0YXRlID0gZy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0ICsgMiAqIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJmb250LXNpemVcIiwgZ2V0Q29uZmlnKCkuc3RhdGUuZm9udFNpemUpLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlLXRpdGxlXCIpLnRleHQoc3RhdGVEZWYuaWQpO1xuICBjb25zdCBjbGFzc0JveCA9IHN0YXRlLm5vZGUoKS5nZXRCQm94KCk7XG4gIGcuaW5zZXJ0KFwicmVjdFwiLCBcIjpmaXJzdC1jaGlsZFwiKS5hdHRyKFwieFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwid2lkdGhcIiwgY2xhc3NCb3gud2lkdGggKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcImhlaWdodFwiLCBjbGFzc0JveC5oZWlnaHQgKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcInJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnJhZGl1cyk7XG4gIHJldHVybiBzdGF0ZTtcbn07XG5jb25zdCBkcmF3RGVzY3JTdGF0ZSA9IChnLCBzdGF0ZURlZikgPT4ge1xuICBjb25zdCBhZGRUc3BhbiA9IGZ1bmN0aW9uKHRleHRFbCwgdHh0LCBpc0ZpcnN0Mikge1xuICAgIGNvbnN0IHRTcGFuID0gdGV4dEVsLmFwcGVuZChcInRzcGFuXCIpLmF0dHIoXCJ4XCIsIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS50ZXh0KHR4dCk7XG4gICAgaWYgKCFpc0ZpcnN0Mikge1xuICAgICAgdFNwYW4uYXR0cihcImR5XCIsIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgdGl0bGUgPSBnLmFwcGVuZChcInRleHRcIikuYXR0cihcInhcIiwgMiAqIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJ5XCIsIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgKyAxLjMgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwiZm9udC1zaXplXCIsIGdldENvbmZpZygpLnN0YXRlLmZvbnRTaXplKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZS10aXRsZVwiKS50ZXh0KHN0YXRlRGVmLmRlc2NyaXB0aW9uc1swXSk7XG4gIGNvbnN0IHRpdGxlQm94ID0gdGl0bGUubm9kZSgpLmdldEJCb3goKTtcbiAgY29uc3QgdGl0bGVIZWlnaHQgPSB0aXRsZUJveC5oZWlnaHQ7XG4gIGNvbnN0IGRlc2NyaXB0aW9uID0gZy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXG4gICAgXCJ5XCIsXG4gICAgdGl0bGVIZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICogMC40ICsgZ2V0Q29uZmlnKCkuc3RhdGUuZGl2aWRlck1hcmdpbiArIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHRcbiAgKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZS1kZXNjcmlwdGlvblwiKTtcbiAgbGV0IGlzRmlyc3QgPSB0cnVlO1xuICBsZXQgaXNTZWNvbmQgPSB0cnVlO1xuICBzdGF0ZURlZi5kZXNjcmlwdGlvbnMuZm9yRWFjaChmdW5jdGlvbihkZXNjcikge1xuICAgIGlmICghaXNGaXJzdCkge1xuICAgICAgYWRkVHNwYW4oZGVzY3JpcHRpb24sIGRlc2NyLCBpc1NlY29uZCk7XG4gICAgICBpc1NlY29uZCA9IGZhbHNlO1xuICAgIH1cbiAgICBpc0ZpcnN0ID0gZmFsc2U7XG4gIH0pO1xuICBjb25zdCBkZXNjckxpbmUgPSBnLmFwcGVuZChcImxpbmVcIikuYXR0cihcIngxXCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJ5MVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgdGl0bGVIZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS5kaXZpZGVyTWFyZ2luIC8gMikuYXR0cihcInkyXCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyB0aXRsZUhlaWdodCArIGdldENvbmZpZygpLnN0YXRlLmRpdmlkZXJNYXJnaW4gLyAyKS5hdHRyKFwiY2xhc3NcIiwgXCJkZXNjci1kaXZpZGVyXCIpO1xuICBjb25zdCBkZXNjckJveCA9IGRlc2NyaXB0aW9uLm5vZGUoKS5nZXRCQm94KCk7XG4gIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoZGVzY3JCb3gud2lkdGgsIHRpdGxlQm94LndpZHRoKTtcbiAgZGVzY3JMaW5lLmF0dHIoXCJ4MlwiLCB3aWR0aCArIDMgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKTtcbiAgZy5pbnNlcnQoXCJyZWN0XCIsIFwiOmZpcnN0LWNoaWxkXCIpLmF0dHIoXCJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJ5XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwiaGVpZ2h0XCIsIGRlc2NyQm94LmhlaWdodCArIHRpdGxlSGVpZ2h0ICsgMiAqIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJyeFwiLCBnZXRDb25maWcoKS5zdGF0ZS5yYWRpdXMpO1xuICByZXR1cm4gZztcbn07XG5jb25zdCBhZGRUaXRsZUFuZEJveCA9IChnLCBzdGF0ZURlZiwgYWx0QmtnKSA9PiB7XG4gIGNvbnN0IHBhZCA9IGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmc7XG4gIGNvbnN0IGRibFBhZCA9IDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nO1xuICBjb25zdCBvcmdCb3ggPSBnLm5vZGUoKS5nZXRCQm94KCk7XG4gIGNvbnN0IG9yZ1dpZHRoID0gb3JnQm94LndpZHRoO1xuICBjb25zdCBvcmdYID0gb3JnQm94Lng7XG4gIGNvbnN0IHRpdGxlID0gZy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIGdldENvbmZpZygpLnN0YXRlLnRpdGxlU2hpZnQpLmF0dHIoXCJmb250LXNpemVcIiwgZ2V0Q29uZmlnKCkuc3RhdGUuZm9udFNpemUpLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlLXRpdGxlXCIpLnRleHQoc3RhdGVEZWYuaWQpO1xuICBjb25zdCB0aXRsZUJveCA9IHRpdGxlLm5vZGUoKS5nZXRCQm94KCk7XG4gIGNvbnN0IHRpdGxlV2lkdGggPSB0aXRsZUJveC53aWR0aCArIGRibFBhZDtcbiAgbGV0IHdpZHRoID0gTWF0aC5tYXgodGl0bGVXaWR0aCwgb3JnV2lkdGgpO1xuICBpZiAod2lkdGggPT09IG9yZ1dpZHRoKSB7XG4gICAgd2lkdGggPSB3aWR0aCArIGRibFBhZDtcbiAgfVxuICBsZXQgc3RhcnRYO1xuICBjb25zdCBncmFwaEJveCA9IGcubm9kZSgpLmdldEJCb3goKTtcbiAgaWYgKHN0YXRlRGVmLmRvYylcbiAgICA7XG4gIHN0YXJ0WCA9IG9yZ1ggLSBwYWQ7XG4gIGlmICh0aXRsZVdpZHRoID4gb3JnV2lkdGgpIHtcbiAgICBzdGFydFggPSAob3JnV2lkdGggLSB3aWR0aCkgLyAyICsgcGFkO1xuICB9XG4gIGlmIChNYXRoLmFicyhvcmdYIC0gZ3JhcGhCb3gueCkgPCBwYWQgJiYgdGl0bGVXaWR0aCA+IG9yZ1dpZHRoKSB7XG4gICAgc3RhcnRYID0gb3JnWCAtICh0aXRsZVdpZHRoIC0gb3JnV2lkdGgpIC8gMjtcbiAgfVxuICBjb25zdCBsaW5lWSA9IDEgLSBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0O1xuICBnLmluc2VydChcInJlY3RcIiwgXCI6Zmlyc3QtY2hpbGRcIikuYXR0cihcInhcIiwgc3RhcnRYKS5hdHRyKFwieVwiLCBsaW5lWSkuYXR0cihcImNsYXNzXCIsIGFsdEJrZyA/IFwiYWx0LWNvbXBvc2l0XCIgOiBcImNvbXBvc2l0XCIpLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCkuYXR0cihcbiAgICBcImhlaWdodFwiLFxuICAgIGdyYXBoQm94LmhlaWdodCArIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS50aXRsZVNoaWZ0ICsgMVxuICApLmF0dHIoXCJyeFwiLCBcIjBcIik7XG4gIHRpdGxlLmF0dHIoXCJ4XCIsIHN0YXJ0WCArIHBhZCk7XG4gIGlmICh0aXRsZVdpZHRoIDw9IG9yZ1dpZHRoKSB7XG4gICAgdGl0bGUuYXR0cihcInhcIiwgb3JnWCArICh3aWR0aCAtIGRibFBhZCkgLyAyIC0gdGl0bGVXaWR0aCAvIDIgKyBwYWQpO1xuICB9XG4gIGcuaW5zZXJ0KFwicmVjdFwiLCBcIjpmaXJzdC1jaGlsZFwiKS5hdHRyKFwieFwiLCBzdGFydFgpLmF0dHIoXG4gICAgXCJ5XCIsXG4gICAgZ2V0Q29uZmlnKCkuc3RhdGUudGl0bGVTaGlmdCAtIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgLSBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nXG4gICkuYXR0cihcIndpZHRoXCIsIHdpZHRoKS5hdHRyKFwiaGVpZ2h0XCIsIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgKiAzKS5hdHRyKFwicnhcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucmFkaXVzKTtcbiAgZy5pbnNlcnQoXCJyZWN0XCIsIFwiOmZpcnN0LWNoaWxkXCIpLmF0dHIoXCJ4XCIsIHN0YXJ0WCkuYXR0cihcbiAgICBcInlcIixcbiAgICBnZXRDb25maWcoKS5zdGF0ZS50aXRsZVNoaWZ0IC0gZ2V0Q29uZmlnKCkuc3RhdGUudGV4dEhlaWdodCAtIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmdcbiAgKS5hdHRyKFwid2lkdGhcIiwgd2lkdGgpLmF0dHIoXCJoZWlnaHRcIiwgZ3JhcGhCb3guaGVpZ2h0ICsgMyArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0KS5hdHRyKFwicnhcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucmFkaXVzKTtcbiAgcmV0dXJuIGc7XG59O1xuY29uc3QgZHJhd0VuZFN0YXRlID0gKGcpID0+IHtcbiAgZy5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcImNsYXNzXCIsIFwiZW5kLXN0YXRlLW91dGVyXCIpLmF0dHIoXCJyXCIsIGdldENvbmZpZygpLnN0YXRlLnNpemVVbml0ICsgZ2V0Q29uZmlnKCkuc3RhdGUubWluaVBhZGRpbmcpLmF0dHIoXG4gICAgXCJjeFwiLFxuICAgIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCArIGdldENvbmZpZygpLnN0YXRlLm1pbmlQYWRkaW5nXG4gICkuYXR0cihcbiAgICBcImN5XCIsXG4gICAgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyArIGdldENvbmZpZygpLnN0YXRlLnNpemVVbml0ICsgZ2V0Q29uZmlnKCkuc3RhdGUubWluaVBhZGRpbmdcbiAgKTtcbiAgcmV0dXJuIGcuYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJjbGFzc1wiLCBcImVuZC1zdGF0ZS1pbm5lclwiKS5hdHRyKFwiclwiLCBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCkuYXR0cihcImN4XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCArIDIpLmF0dHIoXCJjeVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQgKyAyKTtcbn07XG5jb25zdCBkcmF3Rm9ya0pvaW5TdGF0ZSA9IChnLCBzdGF0ZURlZikgPT4ge1xuICBsZXQgd2lkdGggPSBnZXRDb25maWcoKS5zdGF0ZS5mb3JrV2lkdGg7XG4gIGxldCBoZWlnaHQgPSBnZXRDb25maWcoKS5zdGF0ZS5mb3JrSGVpZ2h0O1xuICBpZiAoc3RhdGVEZWYucGFyZW50SWQpIHtcbiAgICBsZXQgdG1wID0gd2lkdGg7XG4gICAgd2lkdGggPSBoZWlnaHQ7XG4gICAgaGVpZ2h0ID0gdG1wO1xuICB9XG4gIHJldHVybiBnLmFwcGVuZChcInJlY3RcIikuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKS5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKS5hdHRyKFwid2lkdGhcIiwgd2lkdGgpLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KS5hdHRyKFwieFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKTtcbn07XG5jb25zdCBfZHJhd0xvbmdUZXh0ID0gKF90ZXh0LCB4LCB5LCBnKSA9PiB7XG4gIGxldCB0ZXh0SGVpZ2h0ID0gMDtcbiAgY29uc3QgdGV4dEVsZW0gPSBnLmFwcGVuZChcInRleHRcIik7XG4gIHRleHRFbGVtLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKTtcbiAgdGV4dEVsZW0uYXR0cihcImNsYXNzXCIsIFwibm90ZVRleHRcIik7XG4gIGxldCB0ZXh0ID0gX3RleHQucmVwbGFjZSgvXFxyXFxuL2csIFwiPGJyLz5cIik7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcbi9nLCBcIjxici8+XCIpO1xuICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoY29tbW9uLmxpbmVCcmVha1JlZ2V4KTtcbiAgbGV0IHRIZWlnaHQgPSAxLjI1ICogZ2V0Q29uZmlnKCkuc3RhdGUubm90ZU1hcmdpbjtcbiAgZm9yIChjb25zdCBsaW5lMiBvZiBsaW5lcykge1xuICAgIGNvbnN0IHR4dCA9IGxpbmUyLnRyaW0oKTtcbiAgICBpZiAodHh0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHNwYW4gPSB0ZXh0RWxlbS5hcHBlbmQoXCJ0c3BhblwiKTtcbiAgICAgIHNwYW4udGV4dCh0eHQpO1xuICAgICAgaWYgKHRIZWlnaHQgPT09IDApIHtcbiAgICAgICAgY29uc3QgdGV4dEJvdW5kcyA9IHNwYW4ubm9kZSgpLmdldEJCb3goKTtcbiAgICAgICAgdEhlaWdodCArPSB0ZXh0Qm91bmRzLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIHRleHRIZWlnaHQgKz0gdEhlaWdodDtcbiAgICAgIHNwYW4uYXR0cihcInhcIiwgeCArIGdldENvbmZpZygpLnN0YXRlLm5vdGVNYXJnaW4pO1xuICAgICAgc3Bhbi5hdHRyKFwieVwiLCB5ICsgdGV4dEhlaWdodCArIDEuMjUgKiBnZXRDb25maWcoKS5zdGF0ZS5ub3RlTWFyZ2luKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHsgdGV4dFdpZHRoOiB0ZXh0RWxlbS5ub2RlKCkuZ2V0QkJveCgpLndpZHRoLCB0ZXh0SGVpZ2h0IH07XG59O1xuY29uc3QgZHJhd05vdGUgPSAodGV4dCwgZykgPT4ge1xuICBnLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlLW5vdGVcIik7XG4gIGNvbnN0IG5vdGUgPSBnLmFwcGVuZChcInJlY3RcIikuYXR0cihcInhcIiwgMCkuYXR0cihcInlcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyk7XG4gIGNvbnN0IHJlY3RFbGVtID0gZy5hcHBlbmQoXCJnXCIpO1xuICBjb25zdCB7IHRleHRXaWR0aCwgdGV4dEhlaWdodCB9ID0gX2RyYXdMb25nVGV4dCh0ZXh0LCAwLCAwLCByZWN0RWxlbSk7XG4gIG5vdGUuYXR0cihcImhlaWdodFwiLCB0ZXh0SGVpZ2h0ICsgMiAqIGdldENvbmZpZygpLnN0YXRlLm5vdGVNYXJnaW4pO1xuICBub3RlLmF0dHIoXCJ3aWR0aFwiLCB0ZXh0V2lkdGggKyBnZXRDb25maWcoKS5zdGF0ZS5ub3RlTWFyZ2luICogMik7XG4gIHJldHVybiBub3RlO1xufTtcbmNvbnN0IGRyYXdTdGF0ZSA9IGZ1bmN0aW9uKGVsZW0sIHN0YXRlRGVmKSB7XG4gIGNvbnN0IGlkID0gc3RhdGVEZWYuaWQ7XG4gIGNvbnN0IHN0YXRlSW5mbyA9IHtcbiAgICBpZCxcbiAgICBsYWJlbDogc3RhdGVEZWYuaWQsXG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwXG4gIH07XG4gIGNvbnN0IGcgPSBlbGVtLmFwcGVuZChcImdcIikuYXR0cihcImlkXCIsIGlkKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZUdyb3VwXCIpO1xuICBpZiAoc3RhdGVEZWYudHlwZSA9PT0gXCJzdGFydFwiKSB7XG4gICAgZHJhd1N0YXJ0U3RhdGUoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZW5kXCIpIHtcbiAgICBkcmF3RW5kU3RhdGUoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZm9ya1wiIHx8IHN0YXRlRGVmLnR5cGUgPT09IFwiam9pblwiKSB7XG4gICAgZHJhd0ZvcmtKb2luU3RhdGUoZywgc3RhdGVEZWYpO1xuICB9XG4gIGlmIChzdGF0ZURlZi50eXBlID09PSBcIm5vdGVcIikge1xuICAgIGRyYXdOb3RlKHN0YXRlRGVmLm5vdGUudGV4dCwgZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZGl2aWRlclwiKSB7XG4gICAgZHJhd0RpdmlkZXIoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZGVmYXVsdFwiICYmIHN0YXRlRGVmLmRlc2NyaXB0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICBkcmF3U2ltcGxlU3RhdGUoZywgc3RhdGVEZWYpO1xuICB9XG4gIGlmIChzdGF0ZURlZi50eXBlID09PSBcImRlZmF1bHRcIiAmJiBzdGF0ZURlZi5kZXNjcmlwdGlvbnMubGVuZ3RoID4gMCkge1xuICAgIGRyYXdEZXNjclN0YXRlKGcsIHN0YXRlRGVmKTtcbiAgfVxuICBjb25zdCBzdGF0ZUJveCA9IGcubm9kZSgpLmdldEJCb3goKTtcbiAgc3RhdGVJbmZvLndpZHRoID0gc3RhdGVCb3gud2lkdGggKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZztcbiAgc3RhdGVJbmZvLmhlaWdodCA9IHN0YXRlQm94LmhlaWdodCArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nO1xuICBpZENhY2hlJDEuc2V0KGlkLCBzdGF0ZUluZm8pO1xuICByZXR1cm4gc3RhdGVJbmZvO1xufTtcbmxldCBlZGdlQ291bnQgPSAwO1xuY29uc3QgZHJhd0VkZ2UgPSBmdW5jdGlvbihlbGVtLCBwYXRoLCByZWxhdGlvbikge1xuICBjb25zdCBnZXRSZWxhdGlvblR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIGRiLnJlbGF0aW9uVHlwZS5BR0dSRUdBVElPTjpcbiAgICAgICAgcmV0dXJuIFwiYWdncmVnYXRpb25cIjtcbiAgICAgIGNhc2UgZGIucmVsYXRpb25UeXBlLkVYVEVOU0lPTjpcbiAgICAgICAgcmV0dXJuIFwiZXh0ZW5zaW9uXCI7XG4gICAgICBjYXNlIGRiLnJlbGF0aW9uVHlwZS5DT01QT1NJVElPTjpcbiAgICAgICAgcmV0dXJuIFwiY29tcG9zaXRpb25cIjtcbiAgICAgIGNhc2UgZGIucmVsYXRpb25UeXBlLkRFUEVOREVOQ1k6XG4gICAgICAgIHJldHVybiBcImRlcGVuZGVuY3lcIjtcbiAgICB9XG4gIH07XG4gIHBhdGgucG9pbnRzID0gcGF0aC5wb2ludHMuZmlsdGVyKChwKSA9PiAhTnVtYmVyLmlzTmFOKHAueSkpO1xuICBjb25zdCBsaW5lRGF0YSA9IHBhdGgucG9pbnRzO1xuICBjb25zdCBsaW5lRnVuY3Rpb24gPSBsaW5lKCkueChmdW5jdGlvbihkKSB7XG4gICAgcmV0dXJuIGQueDtcbiAgfSkueShmdW5jdGlvbihkKSB7XG4gICAgcmV0dXJuIGQueTtcbiAgfSkuY3VydmUoY3VydmVCYXNpcyk7XG4gIGNvbnN0IHN2Z1BhdGggPSBlbGVtLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgbGluZUZ1bmN0aW9uKGxpbmVEYXRhKSkuYXR0cihcImlkXCIsIFwiZWRnZVwiICsgZWRnZUNvdW50KS5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFuc2l0aW9uXCIpO1xuICBsZXQgdXJsID0gXCJcIjtcbiAgaWYgKGdldENvbmZpZygpLnN0YXRlLmFycm93TWFya2VyQWJzb2x1dGUpIHtcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XG4gICAgdXJsID0gdXJsLnJlcGxhY2UoL1xcKC9nLCBcIlxcXFwoXCIpO1xuICAgIHVybCA9IHVybC5yZXBsYWNlKC9cXCkvZywgXCJcXFxcKVwiKTtcbiAgfVxuICBzdmdQYXRoLmF0dHIoXG4gICAgXCJtYXJrZXItZW5kXCIsXG4gICAgXCJ1cmwoXCIgKyB1cmwgKyBcIiNcIiArIGdldFJlbGF0aW9uVHlwZShkYi5yZWxhdGlvblR5cGUuREVQRU5ERU5DWSkgKyBcIkVuZClcIlxuICApO1xuICBpZiAocmVsYXRpb24udGl0bGUgIT09IHZvaWQgMCkge1xuICAgIGNvbnN0IGxhYmVsID0gZWxlbS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlTGFiZWxcIik7XG4gICAgY29uc3QgeyB4LCB5IH0gPSB1dGlscy5jYWxjTGFiZWxQb3NpdGlvbihwYXRoLnBvaW50cyk7XG4gICAgY29uc3Qgcm93cyA9IGNvbW1vbi5nZXRSb3dzKHJlbGF0aW9uLnRpdGxlKTtcbiAgICBsZXQgdGl0bGVIZWlnaHQgPSAwO1xuICAgIGNvbnN0IHRpdGxlUm93cyA9IFtdO1xuICAgIGxldCBtYXhXaWR0aCA9IDA7XG4gICAgbGV0IG1pblggPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRpdGxlID0gbGFiZWwuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIikudGV4dChyb3dzW2ldKS5hdHRyKFwieFwiLCB4KS5hdHRyKFwieVwiLCB5ICsgdGl0bGVIZWlnaHQpO1xuICAgICAgY29uc3QgYm91bmRzVG1wID0gdGl0bGUubm9kZSgpLmdldEJCb3goKTtcbiAgICAgIG1heFdpZHRoID0gTWF0aC5tYXgobWF4V2lkdGgsIGJvdW5kc1RtcC53aWR0aCk7XG4gICAgICBtaW5YID0gTWF0aC5taW4obWluWCwgYm91bmRzVG1wLngpO1xuICAgICAgbG9nLmluZm8oYm91bmRzVG1wLngsIHgsIHkgKyB0aXRsZUhlaWdodCk7XG4gICAgICBpZiAodGl0bGVIZWlnaHQgPT09IDApIHtcbiAgICAgICAgY29uc3QgdGl0bGVCb3ggPSB0aXRsZS5ub2RlKCkuZ2V0QkJveCgpO1xuICAgICAgICB0aXRsZUhlaWdodCA9IHRpdGxlQm94LmhlaWdodDtcbiAgICAgICAgbG9nLmluZm8oXCJUaXRsZSBoZWlnaHRcIiwgdGl0bGVIZWlnaHQsIHkpO1xuICAgICAgfVxuICAgICAgdGl0bGVSb3dzLnB1c2godGl0bGUpO1xuICAgIH1cbiAgICBsZXQgYm94SGVpZ2h0ID0gdGl0bGVIZWlnaHQgKiByb3dzLmxlbmd0aDtcbiAgICBpZiAocm93cy5sZW5ndGggPiAxKSB7XG4gICAgICBjb25zdCBoZWlnaHRBZGogPSAocm93cy5sZW5ndGggLSAxKSAqIHRpdGxlSGVpZ2h0ICogMC41O1xuICAgICAgdGl0bGVSb3dzLmZvckVhY2goKHRpdGxlLCBpKSA9PiB0aXRsZS5hdHRyKFwieVwiLCB5ICsgaSAqIHRpdGxlSGVpZ2h0IC0gaGVpZ2h0QWRqKSk7XG4gICAgICBib3hIZWlnaHQgPSB0aXRsZUhlaWdodCAqIHJvd3MubGVuZ3RoO1xuICAgIH1cbiAgICBjb25zdCBib3VuZHMgPSBsYWJlbC5ub2RlKCkuZ2V0QkJveCgpO1xuICAgIGxhYmVsLmluc2VydChcInJlY3RcIiwgXCI6Zmlyc3QtY2hpbGRcIikuYXR0cihcImNsYXNzXCIsIFwiYm94XCIpLmF0dHIoXCJ4XCIsIHggLSBtYXhXaWR0aCAvIDIgLSBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nIC8gMikuYXR0cihcInlcIiwgeSAtIGJveEhlaWdodCAvIDIgLSBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nIC8gMiAtIDMuNSkuYXR0cihcIndpZHRoXCIsIG1heFdpZHRoICsgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcImhlaWdodFwiLCBib3hIZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKTtcbiAgICBsb2cuaW5mbyhib3VuZHMpO1xuICB9XG4gIGVkZ2VDb3VudCsrO1xufTtcbmxldCBjb25mO1xuY29uc3QgdHJhbnNmb3JtYXRpb25Mb2cgPSB7fTtcbmNvbnN0IHNldENvbmYgPSBmdW5jdGlvbigpIHtcbn07XG5jb25zdCBpbnNlcnRNYXJrZXJzID0gZnVuY3Rpb24oZWxlbSkge1xuICBlbGVtLmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwibWFya2VyXCIpLmF0dHIoXCJpZFwiLCBcImRlcGVuZGVuY3lFbmRcIikuYXR0cihcInJlZlhcIiwgMTkpLmF0dHIoXCJyZWZZXCIsIDcpLmF0dHIoXCJtYXJrZXJXaWR0aFwiLCAyMCkuYXR0cihcIm1hcmtlckhlaWdodFwiLCAyOCkuYXR0cihcIm9yaWVudFwiLCBcImF1dG9cIikuYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCBcIk0gMTksNyBMOSwxMyBMMTQsNyBMOSwxIFpcIik7XG59O1xuY29uc3QgZHJhdyA9IGZ1bmN0aW9uKHRleHQsIGlkLCBfdmVyc2lvbiwgZGlhZ09iaikge1xuICBjb25mID0gZ2V0Q29uZmlnKCkuc3RhdGU7XG4gIGNvbnN0IHNlY3VyaXR5TGV2ZWwgPSBnZXRDb25maWcoKS5zZWN1cml0eUxldmVsO1xuICBsZXQgc2FuZGJveEVsZW1lbnQ7XG4gIGlmIChzZWN1cml0eUxldmVsID09PSBcInNhbmRib3hcIikge1xuICAgIHNhbmRib3hFbGVtZW50ID0gc2VsZWN0KFwiI2lcIiArIGlkKTtcbiAgfVxuICBjb25zdCByb290ID0gc2VjdXJpdHlMZXZlbCA9PT0gXCJzYW5kYm94XCIgPyBzZWxlY3Qoc2FuZGJveEVsZW1lbnQubm9kZXMoKVswXS5jb250ZW50RG9jdW1lbnQuYm9keSkgOiBzZWxlY3QoXCJib2R5XCIpO1xuICBjb25zdCBkb2MgPSBzZWN1cml0eUxldmVsID09PSBcInNhbmRib3hcIiA/IHNhbmRib3hFbGVtZW50Lm5vZGVzKClbMF0uY29udGVudERvY3VtZW50IDogZG9jdW1lbnQ7XG4gIGxvZy5kZWJ1ZyhcIlJlbmRlcmluZyBkaWFncmFtIFwiICsgdGV4dCk7XG4gIGNvbnN0IGRpYWdyYW0yID0gcm9vdC5zZWxlY3QoYFtpZD0nJHtpZH0nXWApO1xuICBpbnNlcnRNYXJrZXJzKGRpYWdyYW0yKTtcbiAgY29uc3Qgcm9vdERvYyA9IGRpYWdPYmouZGIuZ2V0Um9vdERvYygpO1xuICByZW5kZXJEb2Mocm9vdERvYywgZGlhZ3JhbTIsIHZvaWQgMCwgZmFsc2UsIHJvb3QsIGRvYywgZGlhZ09iaik7XG4gIGNvbnN0IHBhZGRpbmcgPSBjb25mLnBhZGRpbmc7XG4gIGNvbnN0IGJvdW5kcyA9IGRpYWdyYW0yLm5vZGUoKS5nZXRCQm94KCk7XG4gIGNvbnN0IHdpZHRoID0gYm91bmRzLndpZHRoICsgcGFkZGluZyAqIDI7XG4gIGNvbnN0IGhlaWdodCA9IGJvdW5kcy5oZWlnaHQgKyBwYWRkaW5nICogMjtcbiAgY29uc3Qgc3ZnV2lkdGggPSB3aWR0aCAqIDEuNzU7XG4gIGNvbmZpZ3VyZVN2Z1NpemUoZGlhZ3JhbTIsIGhlaWdodCwgc3ZnV2lkdGgsIGNvbmYudXNlTWF4V2lkdGgpO1xuICBkaWFncmFtMi5hdHRyKFxuICAgIFwidmlld0JveFwiLFxuICAgIGAke2JvdW5kcy54IC0gY29uZi5wYWRkaW5nfSAgJHtib3VuZHMueSAtIGNvbmYucGFkZGluZ30gYCArIHdpZHRoICsgXCIgXCIgKyBoZWlnaHRcbiAgKTtcbn07XG5jb25zdCBnZXRMYWJlbFdpZHRoID0gKHRleHQpID0+IHtcbiAgcmV0dXJuIHRleHQgPyB0ZXh0Lmxlbmd0aCAqIGNvbmYuZm9udFNpemVGYWN0b3IgOiAxO1xufTtcbmNvbnN0IHJlbmRlckRvYyA9IChkb2MsIGRpYWdyYW0yLCBwYXJlbnRJZCwgYWx0QmtnLCByb290LCBkb21Eb2N1bWVudCwgZGlhZ09iaikgPT4ge1xuICBjb25zdCBncmFwaCA9IG5ldyBncmFwaGxpYi5HcmFwaCh7XG4gICAgY29tcG91bmQ6IHRydWUsXG4gICAgbXVsdGlncmFwaDogdHJ1ZVxuICB9KTtcbiAgbGV0IGk7XG4gIGxldCBlZGdlRnJlZURvYyA9IHRydWU7XG4gIGZvciAoaSA9IDA7IGkgPCBkb2MubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoZG9jW2ldLnN0bXQgPT09IFwicmVsYXRpb25cIikge1xuICAgICAgZWRnZUZyZWVEb2MgPSBmYWxzZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBpZiAocGFyZW50SWQpIHtcbiAgICBncmFwaC5zZXRHcmFwaCh7XG4gICAgICByYW5rZGlyOiBcIkxSXCIsXG4gICAgICBtdWx0aWdyYXBoOiB0cnVlLFxuICAgICAgY29tcG91bmQ6IHRydWUsXG4gICAgICAvLyBhY3ljbGljZXI6ICdncmVlZHknLFxuICAgICAgcmFua2VyOiBcInRpZ2h0LXRyZWVcIixcbiAgICAgIHJhbmtzZXA6IGVkZ2VGcmVlRG9jID8gMSA6IGNvbmYuZWRnZUxlbmd0aEZhY3RvcixcbiAgICAgIG5vZGVTZXA6IGVkZ2VGcmVlRG9jID8gMSA6IDUwLFxuICAgICAgaXNNdWx0aUdyYXBoOiB0cnVlXG4gICAgICAvLyByYW5rc2VwOiA1LFxuICAgICAgLy8gbm9kZXNlcDogMVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGdyYXBoLnNldEdyYXBoKHtcbiAgICAgIHJhbmtkaXI6IFwiVEJcIixcbiAgICAgIG11bHRpZ3JhcGg6IHRydWUsXG4gICAgICBjb21wb3VuZDogdHJ1ZSxcbiAgICAgIC8vIGlzQ29tcG91bmQ6IHRydWUsXG4gICAgICAvLyBhY3ljbGljZXI6ICdncmVlZHknLFxuICAgICAgLy8gcmFua2VyOiAnbG9uZ2VzdC1wYXRoJ1xuICAgICAgcmFua3NlcDogZWRnZUZyZWVEb2MgPyAxIDogY29uZi5lZGdlTGVuZ3RoRmFjdG9yLFxuICAgICAgbm9kZVNlcDogZWRnZUZyZWVEb2MgPyAxIDogNTAsXG4gICAgICByYW5rZXI6IFwidGlnaHQtdHJlZVwiLFxuICAgICAgLy8gcmFua2VyOiAnbmV0d29yay1zaW1wbGV4J1xuICAgICAgaXNNdWx0aUdyYXBoOiB0cnVlXG4gICAgfSk7XG4gIH1cbiAgZ3JhcGguc2V0RGVmYXVsdEVkZ2VMYWJlbChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge307XG4gIH0pO1xuICBkaWFnT2JqLmRiLmV4dHJhY3QoZG9jKTtcbiAgY29uc3Qgc3RhdGVzID0gZGlhZ09iai5kYi5nZXRTdGF0ZXMoKTtcbiAgY29uc3QgcmVsYXRpb25zID0gZGlhZ09iai5kYi5nZXRSZWxhdGlvbnMoKTtcbiAgY29uc3Qga2V5czIgPSBPYmplY3Qua2V5cyhzdGF0ZXMpO1xuICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzMikge1xuICAgIGNvbnN0IHN0YXRlRGVmID0gc3RhdGVzW2tleV07XG4gICAgaWYgKHBhcmVudElkKSB7XG4gICAgICBzdGF0ZURlZi5wYXJlbnRJZCA9IHBhcmVudElkO1xuICAgIH1cbiAgICBsZXQgbm9kZTtcbiAgICBpZiAoc3RhdGVEZWYuZG9jKSB7XG4gICAgICBsZXQgc3ViID0gZGlhZ3JhbTIuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiaWRcIiwgc3RhdGVEZWYuaWQpLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlR3JvdXBcIik7XG4gICAgICBub2RlID0gcmVuZGVyRG9jKHN0YXRlRGVmLmRvYywgc3ViLCBzdGF0ZURlZi5pZCwgIWFsdEJrZywgcm9vdCwgZG9tRG9jdW1lbnQsIGRpYWdPYmopO1xuICAgICAge1xuICAgICAgICBzdWIgPSBhZGRUaXRsZUFuZEJveChzdWIsIHN0YXRlRGVmLCBhbHRCa2cpO1xuICAgICAgICBsZXQgYm94Qm91bmRzID0gc3ViLm5vZGUoKS5nZXRCQm94KCk7XG4gICAgICAgIG5vZGUud2lkdGggPSBib3hCb3VuZHMud2lkdGg7XG4gICAgICAgIG5vZGUuaGVpZ2h0ID0gYm94Qm91bmRzLmhlaWdodCArIGNvbmYucGFkZGluZyAvIDI7XG4gICAgICAgIHRyYW5zZm9ybWF0aW9uTG9nW3N0YXRlRGVmLmlkXSA9IHsgeTogY29uZi5jb21wb3NpdFRpdGxlU2l6ZSB9O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBub2RlID0gZHJhd1N0YXRlKGRpYWdyYW0yLCBzdGF0ZURlZik7XG4gICAgfVxuICAgIGlmIChzdGF0ZURlZi5ub3RlKSB7XG4gICAgICBjb25zdCBub3RlRGVmID0ge1xuICAgICAgICBkZXNjcmlwdGlvbnM6IFtdLFxuICAgICAgICBpZDogc3RhdGVEZWYuaWQgKyBcIi1ub3RlXCIsXG4gICAgICAgIG5vdGU6IHN0YXRlRGVmLm5vdGUsXG4gICAgICAgIHR5cGU6IFwibm90ZVwiXG4gICAgICB9O1xuICAgICAgY29uc3Qgbm90ZSA9IGRyYXdTdGF0ZShkaWFncmFtMiwgbm90ZURlZik7XG4gICAgICBpZiAoc3RhdGVEZWYubm90ZS5wb3NpdGlvbiA9PT0gXCJsZWZ0IG9mXCIpIHtcbiAgICAgICAgZ3JhcGguc2V0Tm9kZShub2RlLmlkICsgXCItbm90ZVwiLCBub3RlKTtcbiAgICAgICAgZ3JhcGguc2V0Tm9kZShub2RlLmlkLCBub2RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdyYXBoLnNldE5vZGUobm9kZS5pZCwgbm9kZSk7XG4gICAgICAgIGdyYXBoLnNldE5vZGUobm9kZS5pZCArIFwiLW5vdGVcIiwgbm90ZSk7XG4gICAgICB9XG4gICAgICBncmFwaC5zZXRQYXJlbnQobm9kZS5pZCwgbm9kZS5pZCArIFwiLWdyb3VwXCIpO1xuICAgICAgZ3JhcGguc2V0UGFyZW50KG5vZGUuaWQgKyBcIi1ub3RlXCIsIG5vZGUuaWQgKyBcIi1ncm91cFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ3JhcGguc2V0Tm9kZShub2RlLmlkLCBub2RlKTtcbiAgICB9XG4gIH1cbiAgbG9nLmRlYnVnKFwiQ291bnQ9XCIsIGdyYXBoLm5vZGVDb3VudCgpLCBncmFwaCk7XG4gIGxldCBjbnQgPSAwO1xuICByZWxhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihyZWxhdGlvbikge1xuICAgIGNudCsrO1xuICAgIGxvZy5kZWJ1ZyhcIlNldHRpbmcgZWRnZVwiLCByZWxhdGlvbik7XG4gICAgZ3JhcGguc2V0RWRnZShcbiAgICAgIHJlbGF0aW9uLmlkMSxcbiAgICAgIHJlbGF0aW9uLmlkMixcbiAgICAgIHtcbiAgICAgICAgcmVsYXRpb24sXG4gICAgICAgIHdpZHRoOiBnZXRMYWJlbFdpZHRoKHJlbGF0aW9uLnRpdGxlKSxcbiAgICAgICAgaGVpZ2h0OiBjb25mLmxhYmVsSGVpZ2h0ICogY29tbW9uLmdldFJvd3MocmVsYXRpb24udGl0bGUpLmxlbmd0aCxcbiAgICAgICAgbGFiZWxwb3M6IFwiY1wiXG4gICAgICB9LFxuICAgICAgXCJpZFwiICsgY250XG4gICAgKTtcbiAgfSk7XG4gIGxheW91dChncmFwaCk7XG4gIGxvZy5kZWJ1ZyhcIkdyYXBoIGFmdGVyIGxheW91dFwiLCBncmFwaC5ub2RlcygpKTtcbiAgY29uc3Qgc3ZnRWxlbSA9IGRpYWdyYW0yLm5vZGUoKTtcbiAgZ3JhcGgubm9kZXMoKS5mb3JFYWNoKGZ1bmN0aW9uKHYpIHtcbiAgICBpZiAodiAhPT0gdm9pZCAwICYmIGdyYXBoLm5vZGUodikgIT09IHZvaWQgMCkge1xuICAgICAgbG9nLndhcm4oXCJOb2RlIFwiICsgdiArIFwiOiBcIiArIEpTT04uc3RyaW5naWZ5KGdyYXBoLm5vZGUodikpKTtcbiAgICAgIHJvb3Quc2VsZWN0KFwiI1wiICsgc3ZnRWxlbS5pZCArIFwiICNcIiArIHYpLmF0dHIoXG4gICAgICAgIFwidHJhbnNmb3JtXCIsXG4gICAgICAgIFwidHJhbnNsYXRlKFwiICsgKGdyYXBoLm5vZGUodikueCAtIGdyYXBoLm5vZGUodikud2lkdGggLyAyKSArIFwiLFwiICsgKGdyYXBoLm5vZGUodikueSArICh0cmFuc2Zvcm1hdGlvbkxvZ1t2XSA/IHRyYW5zZm9ybWF0aW9uTG9nW3ZdLnkgOiAwKSAtIGdyYXBoLm5vZGUodikuaGVpZ2h0IC8gMikgKyBcIiApXCJcbiAgICAgICk7XG4gICAgICByb290LnNlbGVjdChcIiNcIiArIHN2Z0VsZW0uaWQgKyBcIiAjXCIgKyB2KS5hdHRyKFwiZGF0YS14LXNoaWZ0XCIsIGdyYXBoLm5vZGUodikueCAtIGdyYXBoLm5vZGUodikud2lkdGggLyAyKTtcbiAgICAgIGNvbnN0IGRpdmlkZXJzID0gZG9tRG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiNcIiArIHN2Z0VsZW0uaWQgKyBcIiAjXCIgKyB2ICsgXCIgLmRpdmlkZXJcIik7XG4gICAgICBkaXZpZGVycy5mb3JFYWNoKChkaXZpZGVyKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IGRpdmlkZXIucGFyZW50RWxlbWVudDtcbiAgICAgICAgbGV0IHBXaWR0aCA9IDA7XG4gICAgICAgIGxldCBwU2hpZnQgPSAwO1xuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICBwV2lkdGggPSBwYXJlbnQucGFyZW50RWxlbWVudC5nZXRCQm94KCkud2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBTaGlmdCA9IHBhcnNlSW50KHBhcmVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXgtc2hpZnRcIiksIDEwKTtcbiAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHBTaGlmdCkpIHtcbiAgICAgICAgICAgIHBTaGlmdCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRpdmlkZXIuc2V0QXR0cmlidXRlKFwieDFcIiwgMCAtIHBTaGlmdCArIDgpO1xuICAgICAgICBkaXZpZGVyLnNldEF0dHJpYnV0ZShcIngyXCIsIHBXaWR0aCAtIHBTaGlmdCAtIDgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5kZWJ1ZyhcIk5vIE5vZGUgXCIgKyB2ICsgXCI6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JhcGgubm9kZSh2KSkpO1xuICAgIH1cbiAgfSk7XG4gIGxldCBzdGF0ZUJveCA9IHN2Z0VsZW0uZ2V0QkJveCgpO1xuICBncmFwaC5lZGdlcygpLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgIGlmIChlICE9PSB2b2lkIDAgJiYgZ3JhcGguZWRnZShlKSAhPT0gdm9pZCAwKSB7XG4gICAgICBsb2cuZGVidWcoXCJFZGdlIFwiICsgZS52ICsgXCIgLT4gXCIgKyBlLncgKyBcIjogXCIgKyBKU09OLnN0cmluZ2lmeShncmFwaC5lZGdlKGUpKSk7XG4gICAgICBkcmF3RWRnZShkaWFncmFtMiwgZ3JhcGguZWRnZShlKSwgZ3JhcGguZWRnZShlKS5yZWxhdGlvbik7XG4gICAgfVxuICB9KTtcbiAgc3RhdGVCb3ggPSBzdmdFbGVtLmdldEJCb3goKTtcbiAgY29uc3Qgc3RhdGVJbmZvID0ge1xuICAgIGlkOiBwYXJlbnRJZCA/IHBhcmVudElkIDogXCJyb290XCIsXG4gICAgbGFiZWw6IHBhcmVudElkID8gcGFyZW50SWQgOiBcInJvb3RcIixcbiAgICB3aWR0aDogMCxcbiAgICBoZWlnaHQ6IDBcbiAgfTtcbiAgc3RhdGVJbmZvLndpZHRoID0gc3RhdGVCb3gud2lkdGggKyAyICogY29uZi5wYWRkaW5nO1xuICBzdGF0ZUluZm8uaGVpZ2h0ID0gc3RhdGVCb3guaGVpZ2h0ICsgMiAqIGNvbmYucGFkZGluZztcbiAgbG9nLmRlYnVnKFwiRG9jIHJlbmRlcmVkXCIsIHN0YXRlSW5mbywgZ3JhcGgpO1xuICByZXR1cm4gc3RhdGVJbmZvO1xufTtcbmNvbnN0IHJlbmRlcmVyID0ge1xuICBzZXRDb25mLFxuICBkcmF3XG59O1xuY29uc3QgZGlhZ3JhbSA9IHtcbiAgcGFyc2VyLFxuICBkYixcbiAgcmVuZGVyZXIsXG4gIHN0eWxlcyxcbiAgaW5pdDogKGNuZikgPT4ge1xuICAgIGlmICghY25mLnN0YXRlKSB7XG4gICAgICBjbmYuc3RhdGUgPSB7fTtcbiAgICB9XG4gICAgY25mLnN0YXRlLmFycm93TWFya2VyQWJzb2x1dGUgPSBjbmYuYXJyb3dNYXJrZXJBYnNvbHV0ZTtcbiAgICBkYi5jbGVhcigpO1xuICB9XG59O1xuZXhwb3J0IHtcbiAgZGlhZ3JhbVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1331\n')}}]);